<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<!--투데잇 레시피추천 리스트-->
<mapper namespace="com.example.mini.mapper.TodayEatMapper">

 	<select id="selectRecipeInfo" parameterType="hashmap" resultType="com.example.mini.model.TodayEat">
		SELECT R.RECIPE_NO, RECIPE_NAME, COOK_INGRE, IMGT.IMG_PATH AS IMG_PATH_T, IMGC.IMG_PATH AS IMG_PATH_C
		FROM T4_RECIPE AS R
		INNER JOIN T4_R_PURPOSE AS P ON R.RECIPE_NO = P.RECIPE_NO
		INNER JOIN T4_HOWTO AS H ON R.RECIPE_NO = H.RECIPE_NO
		INNER JOIN T4_INGREDIENT AS I ON R.RECIPE_NO = I.RECIPE_NO
		INNER JOIN T4_TOOL AS T ON R.RECIPE_NO = T.RECIPE_NO
		INNER JOIN (SELECT RECIPE_NO, IMG_PATH
					FROM T4_R_IMAGE
					WHERE THUMBNAIL_YN = 'Y') AS IMGT ON R.RECIPE_NO = IMGT.RECIPE_NO 
		INNER JOIN (SELECT RECIPE_NO, IMG_PATH
					FROM T4_R_IMAGE
					ORDER BY COOK_INDEX DESC
					LIMIT 1) AS IMGC ON R.RECIPE_NO = IMGC.RECIPE_NO 
		WHERE DELETE_YN = 'N' AND
			  P.CODE = #{r_purpose} AND
			  H.CODE = #{howto} AND
			  <!-- I.CODE IN (#{ingredient}) AND -->
			  I.CODE IN
			  	<foreach collection="ingredient"  index="index" item="item" open="(" close=")" separator=",">
					#{item}
				</foreach> AND
			  T.CODE = #{tool}
		ORDER BY RAND() LIMIT 1
	</select>

 	<select id="selectStoreInfo" parameterType="hashmap" resultType="com.example.mini.model.TodayEat">

		SELECT M.MENU_NO, MENU_NAME
		FROM T4_MENU AS M
		INNER JOIN T4_PURPOSE AS P ON M.MENU_NO = P.MENU_NO
		INNER JOIN T4_SITUATION AS S ON M.MENU_NO = S.MENU_NO
		INNER JOIN T4_NATION AS N ON M.MENU_NO = N.MENU_NO
		WHERE DELETE_YN = 'N' AND
			  P.CODE = #{purpose} AND
			  S.CODE = #{situation} AND
			  <!-- N.CODE IN (#{nation}) -->
			  N.CODE IN
			  <foreach collection="nation"  index="index" item="item" open="(" close=")" separator=",">
			  	#{item}
			  </foreach>
		ORDER BY RAND() LIMIT 1
	</select>
	
</mapper>