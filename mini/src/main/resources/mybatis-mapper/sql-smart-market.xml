<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<!--스마트마켓 리스트-->
	<mapper namespace="com.example.mini.mapper.SmartMarketMapper">
		<select id="selectSmartMarketList" parameterType="hashmap" resultType="com.example.mini.model.SmartMarket">
			SELECT 
				A.PRODUCT_NO
				, A.PRODUCT_NAME
				, A.PRODUCT_KIND
				, A.PRODUCT_WEIGHT
				, A.PRODUCT_EA
				, A.PRODUCT_VOLUME
				, A.TITLE
				, A.CONTENT
				, A.PRODUCT_PRICE
				, A.PRODUCT_STOCK
				, A.PRODUCT_CNT
				, A.DISCOUNT_YN
				, A.DELETE_YN
				, B.IMG_PATH
                , C.SATISFACTION_GRADE
				, C.REPURCHASE_GRADE
				, C.DELIVERY_GRADE
			FROM T4_PRODUCT A 
			INNER JOIN  T4_P_IMAGE B 
			ON A.PRODUCT_NO=B.PRODUCT_NO
            LEFT JOIN (
					SELECT 
						AVG(SATISFACTION_GRADE) AS SATISFACTION_GRADE
						, AVG(REPURCHASE_GRADE) AS REPURCHASE_GRADE
						, AVG(DELIVERY_GRADE) AS DELIVERY_GRADE
						, PRODUCT_NO
					FROM T4_REVIEW GROUP BY PRODUCT_NO
                    ) C 
			ON A.PRODUCT_NO = C.PRODUCT_NO
			WHERE B.THUMBNAIL_YN='Y'
			<if test="product_kind !='' and product_kind != null">
			AND PRODUCT_KIND = #{product_kind}
		</if>
		</select>
		
		<select id="selectSmartMarketRecommendList" parameterType="hashmap" resultType="com.example.mini.model.SmartMarket">
			SELECT 
				A.PRODUCT_NO
				, A.PRODUCT_NAME
				, A.PRODUCT_KIND
				, A.PRODUCT_WEIGHT
				, A.PRODUCT_EA
				, A.PRODUCT_VOLUME
				, A.TITLE
				, A.CONTENT
				, A.PRODUCT_PRICE
				, A.PRODUCT_STOCK
				, A.PRODUCT_CNT
				, A.DISCOUNT_YN
				, A.DELETE_YN
				, B.IMG_PATH
                , C.SATISFACTION_GRADE
				, C.REPURCHASE_GRADE
				, C.DELIVERY_GRADE
			FROM T4_PRODUCT A 
			INNER JOIN  T4_P_IMAGE B 
			ON A.PRODUCT_NO=B.PRODUCT_NO
            LEFT JOIN (
					SELECT 
						AVG(SATISFACTION_GRADE) AS SATISFACTION_GRADE
						, AVG(REPURCHASE_GRADE) AS REPURCHASE_GRADE
						, AVG(DELIVERY_GRADE) AS DELIVERY_GRADE
						, PRODUCT_NO
					FROM T4_REVIEW GROUP BY PRODUCT_NO
                    ) C 
			ON A.PRODUCT_NO = C.PRODUCT_NO
			WHERE B.THUMBNAIL_YN='Y'
			ORDER BY RAND()
			LIMIT 5		
		</select>
		
		<select id="selectSmartMarketInfo" parameterType="hashmap" resultType="com.example.mini.model.SmartMarket">
			SELECT 
				A.PRODUCT_NO
				, A.PRODUCT_NAME
				, A.PRODUCT_KIND
				, A.PRODUCT_WEIGHT
				, A.PRODUCT_EA
				, A.PRODUCT_VOLUME
				, A.TITLE
				, A.CONTENT
				, A.PRODUCT_PRICE
				, A.PRODUCT_STOCK
				, A.PRODUCT_CNT
				, A.DISCOUNT_YN
				, A.DELETE_YN
				, B.IMG_PATH
                , C.SATISFACTION_GRADE
				, C.REPURCHASE_GRADE
				, C.DELIVERY_GRADE
			FROM T4_PRODUCT A 
			INNER JOIN  T4_P_IMAGE B 
			ON A.PRODUCT_NO=B.PRODUCT_NO
            LEFT JOIN (
					SELECT 
						AVG(SATISFACTION_GRADE) AS SATISFACTION_GRADE
						, AVG(REPURCHASE_GRADE) AS REPURCHASE_GRADE
						, AVG(DELIVERY_GRADE) AS DELIVERY_GRADE
						, PRODUCT_NO
					FROM T4_REVIEW GROUP BY PRODUCT_NO
                    ) C 
			ON A.PRODUCT_NO = C.PRODUCT_NO
			WHERE B.THUMBNAIL_YN='Y'
			<if test="productNo !='' and productNo != null">
			AND A.PRODUCT_NO = #{productNo}
		</if>
		</select>
		
		<select id="selectSmartMarketImgList" parameterType="hashmap" resultType="com.example.mini.model.SmartMarket2">
			SELECT 
				A.PRODUCT_NO
				, A.PRODUCT_NAME
				, A.PRODUCT_KIND
				, A.PRODUCT_WEIGHT
				, A.PRODUCT_EA
				, A.PRODUCT_VOLUME
				, A.TITLE
				, A.CONTENT
				, A.PRODUCT_PRICE
				, A.PRODUCT_STOCK
				, A.PRODUCT_CNT
				, A.DISCOUNT_YN
				, A.DELETE_YN
				, B.IMG_PATH
			FROM T4_PRODUCT A 
			INNER JOIN  T4_P_IMAGE B 
			ON A.PRODUCT_NO=B.PRODUCT_NO
			WHERE 1=1
			AND B.THUMBNAIL_YN='N'
			<if test="productNo !='' and productNo != null">
			AND A.PRODUCT_NO = #{productNo}
		</if>
		</select>
		
		
		
		<select id="selectSmartMarketCnt" parameterType="hashmap" resultType="int">	
			SELECT 
				COUNT(*) AS CNT
			FROM T4_PRODUCT A 
			INNER JOIN  T4_P_IMAGE B 
			ON A.PRODUCT_NO=B.PRODUCT_NO
            LEFT JOIN (
					SELECT 
						AVG(SATISFACTION_GRADE) AS SATISFACTION_GRADE
						, AVG(REPURCHASE_GRADE) AS REPURCHASE_GRADE
						, AVG(DELIVERY_GRADE) AS DELIVERY_GRADE
						, PRODUCT_NO
					FROM T4_REVIEW GROUP BY PRODUCT_NO
                    ) C 
			ON A.PRODUCT_NO = C.PRODUCT_NO
			WHERE 1=1
			<if test="product_no !='' and product_no != null">
				AND A.PRODUCT_NO = #{product_no};
			</if>
		</select>	
		
		<select id="selectSmartMarketKind" parameterType="hashmap" resultType="com.example.mini.model.Code">	
			SELECT 
				KIND,
				CODE,
				NAME,
				IMG
			FROM T4_CODE
			WHERE KIND = 'PKIND'
		</select>
	</mapper>