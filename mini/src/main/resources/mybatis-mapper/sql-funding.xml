<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
	<!--랜선마켓 리스트-->
	<mapper namespace="com.example.mini.mapper.FundingMapper">
		<select id="selectLanList" parameterType="hashmap" resultType="com.example.mini.model.Funding">
			SELECT      
				BOARD_NO,
				A.USER_ID,
				B.NICK,
				TITLE,
				CONTENT,
				HITS,
				BOARD_KIND,
				FINISH_YN,
				CATEGORY,
				CASE
					WHEN CURDATE() = DATE_FORMAT(CDATETIME,'%Y-%m-%d') then DATE_FORMAT(CDATETIME,'%H : %i : %s')
            	    ELSE DATE_FORMAT(CDATETIME,'%Y-%m-%d') 
				END AS CDATETIME,
				CASE
					WHEN CURDATE() = DATE_FORMAT(UDATETIME,'%Y-%m-%d') then DATE_FORMAT(UDATETIME,'%H : %i : %s')
            	    ELSE DATE_FORMAT(UDATETIME,'%Y-%m-%d') 
				END AS UDATETIME,
				DELETE_YN,
				SECRET_YN,
				ANSWER_YN,
            	B.ADDR
			FROM T4_BOARD A
        	LEFT JOIN T4_USER B ON A.USER_ID = B.USER_ID
        	WHERE BOARD_KIND = 'T_LAN' OR BOARD_KIND = 'D_LAN'
		</select>
		
		<!--오픈된 펀딩 리스트-->		
		<select id="selectOpenFundingList" parameterType="hashmap" resultType="com.example.mini.model.Funding">
			<![CDATA[
				SELECT
					A.FUNDING_NO,
					FUNDING_NAME,
					FUNDING_SUMMARY,
					FUNDING_SCRIPT,
					FUNDING_START_DT,
					FUNDING_END_DT,
					FUNDING_CLOSE_YN,
					FUNDING_GOAL_CNT,
					FUNDING_PRICE,
					FORMAT(FUNDING_PRICE , 0) AS FUNDING_PRICE2,
					CDATETIME,
					UDATETIME,
					CNT,
					TIMESTAMPDIFF(DAY, NOW(), FUNDING_END_DT) AS D_DAY,
					IMG_PATH
					
				FROM T4_FUNDING A
				LEFT JOIN (SELECT FUNDING_NO, count(FUNDING_NO) as CNT
							FROM T4_FUNDING_MEMBER
							GROUP BY FUNDING_NO) B ON A.FUNDING_NO = B.FUNDING_NO
				LEFT JOIN (SELECT FUNDING_NO, IMG_PATH
							FROM T4_F_IMAGE
							WHERE THUMBNAIL_YN = 'Y'
							GROUP BY FUNDING_NO) C ON A.FUNDING_NO = C.FUNDING_NO
				WHERE  FUNDING_START_DT < NOW()]]>
				
				<if test = "orderValue == 'endDate'">
				ORDER BY FUNDING_END_DT
				</if>				
				
				<if test = "orderValue == 'rowPrice'">
				ORDER BY FUNDING_PRICE 
				</if>
				
				<if test = "orderValue == 'highPrice'">
				ORDER BY FUNDING_PRICE DESC
				</if>
				
				<if test = "moreBtn == 'off'">
				LIMIT 2
				</if>
			 	
		</select>
		
		<!--준비중 펀딩 리스트-->		
		<select id="selectPlannedFundingList" parameterType="hashmap" resultType="com.example.mini.model.Funding">
			<![CDATA[
				SELECT
					A.FUNDING_NO,
					FUNDING_NAME,
					FUNDING_SUMMARY,
					FUNDING_SCRIPT,
					FUNDING_START_DT,
					FUNDING_END_DT,
					FUNDING_CLOSE_YN,
					FUNDING_GOAL_CNT,
					FUNDING_PRICE,
					FORMAT(FUNDING_PRICE , 0) AS FUNDING_PRICE2,
					CDATETIME,
					UDATETIME,
					CNT,
					TIMESTAMPDIFF(day, now(), FUNDING_END_DT) AS D_DAY,
					CASE 
						WHEN DAYOFWEEK(FUNDING_START_DT) = 1 THEN '(일)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 2 THEN '(월)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 3 THEN '(화)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 4 THEN '(수)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 5 THEN '(목)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 6 THEN '(금)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 7 THEN '(토)'
            		END AS DOW,
            		DATE_FORMAT(FUNDING_START_DT, '%c/%e') AS S_DAY,
            		DATE_FORMAT(FUNDING_START_DT, '%H') AS S_TIME,
            		IMG_PATH
            		
				FROM T4_FUNDING A
				
				LEFT JOIN (SELECT FUNDING_NO, count(FUNDING_NO) as CNT
							FROM T4_FUNDING_MEMBER
							GROUP BY FUNDING_NO) B ON A.FUNDING_NO = B.FUNDING_NO
							
				LEFT JOIN (SELECT FUNDING_NO, IMG_PATH
							FROM T4_F_IMAGE
							WHERE THUMBNAIL_YN = 'Y'
							GROUP BY FUNDING_NO) C ON A.FUNDING_NO = C.FUNDING_NO
							
				WHERE  FUNDING_START_DT > NOW()]]>
				
				<if test = "orderValue2 == 'startDate'">
				ORDER BY FUNDING_START_DT
				</if>				
				
				<if test = "orderValue2 == 'rowPrice'">
				ORDER BY FUNDING_PRICE 
				</if>
				
				<if test = "orderValue2 == 'highPrice'">
				ORDER BY FUNDING_PRICE DESC
				</if>
				
				<if test = "moreBtn2 == 'off'">
				LIMIT 2
				</if>
			 
		</select>
		
		<!--오픈된 펀딩 상세-->
		<select id="selectOpenFundingInfo" parameterType="hashmap" resultType="com.example.mini.model.Funding">
			SELECT
					A.FUNDING_NO,
					FUNDING_NAME,
					FUNDING_SUMMARY,
					FUNDING_SCRIPT,
					FUNDING_START_DT,
					FUNDING_END_DT,
					FUNDING_CLOSE_YN,
					FUNDING_GOAL_CNT,
					FUNDING_PRICE,
					FORMAT(FUNDING_PRICE , 0) AS FUNDING_PRICE2,
					CDATETIME,
					UDATETIME,
					CNT,
					TIMESTAMPDIFF(DAY, NOW(), FUNDING_END_DT) AS D_DAY,
					IMG_PATH,
					IMG_PATH_DETAIL
					
			FROM T4_FUNDING A
			LEFT JOIN (SELECT FUNDING_NO, count(FUNDING_NO) as CNT
						FROM T4_FUNDING_MEMBER
						GROUP BY FUNDING_NO) B ON A.FUNDING_NO = B.FUNDING_NO
			LEFT JOIN (SELECT FUNDING_NO, IMG_PATH
						FROM T4_F_IMAGE
						WHERE THUMBNAIL_YN = 'Y'
						GROUP BY FUNDING_NO) C ON A.FUNDING_NO = C.FUNDING_NO
			LEFT JOIN ( SELECT FUNDING_NO, IMG_PATH AS IMG_PATH_DETAIL
						FROM T4_F_IMAGE
                        WHERE THUMBNAIL_YN = 'N'
						) D ON A.FUNDING_NO = D.FUNDING_NO
			WHERE A.FUNDING_NO = #{fundingNo}
			 
		</select>
		
		<!--준비중 펀딩 상세-->		
		<select id="selectPlannedFundingInfo" parameterType="hashmap" resultType="com.example.mini.model.Funding">
			
				SELECT
					A.FUNDING_NO,
					FUNDING_NAME,
					FUNDING_SUMMARY,
					FUNDING_SCRIPT,
					FUNDING_START_DT,
					FUNDING_END_DT,
					FUNDING_CLOSE_YN,
					FUNDING_GOAL_CNT,
					FUNDING_PRICE,
					FORMAT(FUNDING_PRICE , 0) AS FUNDING_PRICE2,
					CDATETIME,
					UDATETIME,
					CNT,
					TIMESTAMPDIFF(day, now(), FUNDING_END_DT) AS D_DAY,
					CASE 
						WHEN DAYOFWEEK(FUNDING_START_DT) = 1 THEN '(일)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 2 THEN '(월)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 3 THEN '(화)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 4 THEN '(수)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 5 THEN '(목)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 6 THEN '(금)'
                		WHEN DAYOFWEEK(FUNDING_START_DT) = 7 THEN '(토)'
            		END AS DOW,
            		DATE_FORMAT(FUNDING_START_DT, '%c/%e') AS S_DAY,
            		DATE_FORMAT(FUNDING_START_DT, '%H') AS S_TIME,
            		IMG_PATH,
            		IMG_PATH_DETAIL,
            		DATE_FORMAT(FUNDING_START_DT,'%Y-%m-%d') AS START_DATE
            		
				FROM T4_FUNDING A
				
				LEFT JOIN (SELECT FUNDING_NO, count(FUNDING_NO) as CNT
							FROM T4_FUNDING_MEMBER
							GROUP BY FUNDING_NO) B ON A.FUNDING_NO = B.FUNDING_NO
							
				LEFT JOIN (SELECT FUNDING_NO, IMG_PATH
							FROM T4_F_IMAGE
							WHERE THUMBNAIL_YN = 'Y'
							GROUP BY FUNDING_NO) C ON A.FUNDING_NO = C.FUNDING_NO
				LEFT JOIN ( SELECT FUNDING_NO, IMG_PATH AS IMG_PATH_DETAIL
						FROM T4_F_IMAGE
                        WHERE THUMBNAIL_YN = 'N'
						) D ON A.FUNDING_NO = D.FUNDING_NO
									
				WHERE A.FUNDING_NO = #{fundingNo}
				
			 
		</select>
		
	</mapper>